@model SUC_DataEntity.SUC_Order

@{
    ViewBag.Title = "任务分配";
}
@section Styles{
    <link href="~/assets/css/normalize.css" rel="stylesheet" type="text/css">
    <link href="~/assets/css/webflow.css" rel="stylesheet" type="text/css">
    <link href="~/assets/css/videositepro.webflow.css" rel="stylesheet" type="text/css">
    <style>
        .tableblock select {
            width: 100%;
        }

        .tableblock input {
            width: 100%;
        }

        .tableblock textarea {
            width: 100%;
        }
        .tableblock {
            margin:auto;
        }
    </style>
}
<div class="main-content">
    <div class="breadcrumbs ace-save-state" id="breadcrumbs">
        <ul class="breadcrumb">
            <li>
                <i class="menu-icon fa fa-pencil-square-o"></i>
                <a href="#">任务管理</a>
            </li>
            <li class="active">任务派发</li>
        </ul><!-- /.breadcrumb -->

        @*<div class="nav-search" id="nav-search">
            <form class="form-search">
                <span class="input-icon">
                    <input type="text" placeholder="Search ..." class="nav-search-input" id="nav-search-input" autocomplete="off" />
                    <i class="ace-icon fa fa-search nav-search-icon"></i>
                </span>
            </form>
        </div>*@
        <!-- /.nav-search -->
    </div>

    <div class="page-content">
        <div class="page-header">
            <h1>
                任务分配详情
            </h1>
        </div><!-- /.page-header -->
        <div class="row">
            <div class="col-xs-12">
                @*<div class="_w-div">
                        <div class="i-div">
                            <div class="m-i1">0</div>
                            <div class="b-r"></div>
                        </div>
                        <div class="i-div">
                            <div class="b-l"></div>
                            <div class="m-i1">1</div>
                            <div class="b-r"></div>
                        </div>
                        <div class="i-div">
                            <div class="b-l"></div>
                            <div class="m-i1">2</div>
                        </div>
                    </div>
                    <div class="_w-div wd">
                        <div class="i-div">
                            <div class="a">
                                <div class="t">创建工单</div>
                            </div>
                            <div class="b-r none"></div>
                        </div>
                        <div class="i-div">
                            <div class="b-l none"></div>
                            <div class="a">
                                <div >下派工单</div>
                            </div>
                            <div class="b-r none"></div>
                        </div>
                        <div class="i-div">
                            <div class="b-l none"></div>
                            <div class="a">
                                <div >完成工单</div>
                            </div>
                        </div>
                    </div>*@
                <div>
                    <!-- #section:plugins/fuelux.wizard.steps -->
                    <ul class="steps">
                        <li data-step="1" class="active">
                            <span class="step">1</span>
                            <span class="title">任务派发</span>
                        </li>

                        <li data-step="2">
                            <span class="step">2</span>
                            <span class="title">任务接收</span>
                        </li>
                        <li data-step="3">
                            <span class="step">3</span>
                            <span class="title">任务分配</span>
                        </li>
                        <li data-step="4">
                            <span class="step">4</span>
                            <span class="title">任务审核</span>
                        </li>
                        <li data-step="5">
                            <span class="step">5</span>
                            <span class="title">任务反馈</span>
                        </li>
                        <li data-step="6">
                            <span class="step">6</span>
                            <span class="title">任务办结</span>
                        </li>
                    </ul>

                    <!-- /section:plugins/fuelux.wizard.steps -->
                </div>
                <div class="div-block-3">
                    <h3>设备巡检单（周）</h3>
                </div>
                <div class="title">
                    <div class="div-block"></div>
                    <div class="text-block">工单信息</div>
                </div>

                <form class="form-horizontal" role="form" action="/Order/SubmitOrder" method="post">

                    <table class="tableblock">
                        <tr class="row1">
                            <td>
                                <h4 class="hh">工单号：</h4>
                            </td>
                            <td>
                                <h4 class="hh">
                                    @Html.TextBoxFor(c => c.OrderCode)
                                </h4>
                            </td>
                            <td>
                                <h4 class="hh">站点：</h4>
                            </td>
                            <td>
                                <h4 class="hh">
                                    @Html.DropDownListFor(c => c.SiteCode, (List<SelectListItem>)ViewData["siteList"])
                                </h4>
                            </td>

                        </tr>
                        <tr class="row1">
                            <td>
                                <h4 class="hh">工单状态：</h4>
                            </td>
                            <td>
                                <h4 class="hh">
                                    @*@Html.DropDownListFor(c => c.OrderStatus, (List<SelectListItem>)ViewData["statusList"])*@
                                    <select data-val="true" data-val-required="OrderStatus 字段是必需的。" id="OrderStatus" name="OrderStatus" disabled>
                                        <option selected="selected" value="0">下派工单</option>
                                        <option value="1">上报工单</option>
                                        <option value="2">工单审核</option>
                                        <option value="3">工单完成</option>
                                    </select>
                                </h4>
                            </td>
                            <td>
                                <h4 class="hh">计划完成时间：</h4>
                            </td>
                            <td>
                                <h4 class="hh">
                                    <input id="startDate" onclick="WdatePicker({ dateFmt: 'yyyy-MM-dd' });" style="width: 187px;color:#858585;padding: 3px 4px;height: 30px;border:1px solid #D5D5D5;border-radius: 3px" />
                                </h4>
                            </td>
                        </tr>
                        <tr class="row1">
                            <td>
                                <h4 class="hh">工单类型：</h4>
                            </td>
                            <td>
                                <h4 class="hh">
                                    @Html.DropDownListFor(c => c.OrderType, (List<SelectListItem>)ViewData["typeList"])
                                </h4>
                            </td>
                            <td>
                                <h4 class="hh">工单标题：</h4>
                            </td>
                            <td>
                                <h4 class="hh">
                                    @Html.TextBoxFor(c => c.OrderName)
                                </h4>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <h4 class="hh">是否补录：</h4>
                            </td>
                            <td>
                                <h4 class="hh">
                                    @Html.DropDownListFor(c => c.IsSupplement, (List<SelectListItem>)ViewData["isList"])
                                </h4>
                            </td>
                            <td>
                                <h4 class="hh">是否正常：</h4>
                            </td>
                            <td>
                                <h4 class="hh">
                                    @Html.DropDownListFor(c => c.IsNormal, (List<SelectListItem>)ViewData["isList"])

                                </h4>
                            </td>
                        </tr>
                        <tr class="row1">
                            <td>
                                <h4 class="hh">工单内容：</h4>
                            </td>
                            <td colspan="3">
                                <h4 id="w-node-fdcdeb5e5d10-cc3965bd" class="hh">
                                    @Html.TextAreaFor(c => c.Remark)
                                </h4>
                            </td>

                        </tr><!--w-layout-grid grid-->
                    </table>
                    <div class="wizard-actions">
                        <div class="col-md-offset-3 col-md-9">
                            <button class="btn btn-info" type="button" onclick="editOder('submit');">
                                <i class="ace-icon fa fa-check bigger-110"></i>
                                分配任务
                            </button>
                            &nbsp; &nbsp; &nbsp;
                            <button class="btn" type="reset" onclick="back();">
                                <i class="ace-icon fa fa-undo bigger-110"></i>
                                返回
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
@section Scripts{
    <script src="~/assets/js/webflow.js" type="text/javascript"></script>
    <script src="~/assets/js/bootstrap-datepicker.min.js"></script>
    <script src="~/assets/js/jquery.jqGrid.min.js"></script>
    <script src="~/assets/js/grid.locale-en.js"></script>
    <script src="~/assets/js/ace-elements.min.js"></script>
    <script type="text/javascript" src="~/incubator-echarts-4.6.0/dist/echarts.min.js"></script>
    <script src="~/Scripts/My97DatePicker/WdatePicker.js"></script>
    <script src="~/assets/js/bootstrap-datepicker.min.js"></script>

    <script type="text/javascript">
        if ('ontouchstart' in document.documentElement) document.write("<script src='assets/js/jquery.mobile.custom.min.js'>" + "<" + "/script>");
    </script>

    <script type="text/javascript">
        function editOder(flag) {
            var orderCode = $("#OrderCode").val();
            if (orderCode == null || orderCode == "" || orderCode == undefined) {
                alert("工单号不能为空！");
                $("#OrderCode").focus();
                return;
            }

            var OrderStatus = $("#OrderStatus").val();
            if (OrderStatus == null || OrderStatus == "" || OrderStatus == undefined) {
                alert("工单状态不能为空！");
                $("#OrderStatus").focus();
                return;
            } else {
                console.log(OrderStatus);
                if (OrderStatus != '0') {
                    alert("工单状态请选择 创建工单！");
                    $("#OrderStatus").focus();
                    return;
                }
            }

            var siteCode = $('#SiteCode').val();
            if (siteCode == null || siteCode == "" || siteCode == undefined) {
                alert("请选择站点！");
                $("#SiteCode").focus();
                return;
            }

            var finishdate = $('#startDate').val();
            if (finishdate == null || finishdate == "" || finishdate == undefined) {
                alert("计划完成时间不能为空！");
                $("#startDate").focus();
                return;
            }

            var OrderType = $("#OrderType").val();
            if (OrderType == null || OrderType == "" || OrderType == undefined) {
                alert("请选择工单类型！");
                $("#OrderType").focus();
                return;
            }
            var OrderName = $("#OrderName").val();
            if (OrderName == null || OrderName == "" || OrderName == undefined) {
                alert("请选择工单标题！");
                $("#OrderName").focus();
                return;
            }
            var Remark = $("#Remark").val();
            if (Remark == null || Remark == "" || Remark == undefined) {
                alert("请选择工单内容！");
                $("#Remark").focus();
                return;
            }
            var datas = {
                "OrderCode": $("#OrderCode").val(),
                "SiteCode": $("#SiteCode").val(),
                "OrderStatus": $("#OrderStatus").val(),
                "FinishTime": $("#startDate").val(),
                "OrderType": $("#OrderType").val(),
                "OrderName": $("#OrderName").val(),
                "IsSupplement": $("#IsSupplement").val(),
                "IsNormal": $("#IsNormal").val(),
                "Remark": $("#Remark").val()
            }
            var isEdit = $("#editFlag").val();
            $.ajax({
                url: "/Order/SubmitOrder?editFlag=" + flag,
                data: datas,
                dataType: "json",
                type: "POST",
                success: function (data) {
                    if (data.IsSuccess) {
                        var msg = isEdit == 1 ? "修改成功！" : "工单下派成功！";
                        alert(msg);
                        window.location = "/Order/PublishOrderList";
                    } else {
                        alert(data.Msg);
                    }
                }
            });
        }

        function back() {
            window.location = "/Order/List";
        }
    </script>
}
